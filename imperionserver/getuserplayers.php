<?php
include 'dbvars.php';$con=mysqli_connect($dbserver,$dbuser,$dbpass,$dbdata);
// Check connection
if (mysqli_connect_errno()) {  echo "Failed to connect to MySQL: " . mysqli_connect_error();}// escape variables for security
$Id = mysqli_real_escape_string($con, $_GET['Id']);//Query to pull the data - Change tabale name and field name $sql = "SELECT a.*,b.*, b.nr_nivel as nr_nivel_base, a.nr_nivel as nr_nivel_personagem, e.tx_descricao as tx_conselheiro,						    b.nr_custo_nivel as nr_custo_base,							p.id_centro_pesquisa as id_centro_pesquisa,							p.nr_nivel as nr_nivel_centro_pesquisa,							p.nr_personagem_nivel as nr_nivel_personagem_centro_pesquisa,							p.nr_custo_nivel as nr_custo_centro_pesquisa,							p.nr_tecnologia_nivel as nr_tecnolgia_centro_pesquisa,							p.nr_pontos as nr_pontos_centro_pesquisa,							(SELECT nr_nivel FROM tb_pericia_centro WHERE id_centro_pesquisa = p.id_centro_pesquisa AND id_pericia = 1) AS nr_nivel_pericia1,							(SELECT nr_nivel FROM tb_pericia_centro WHERE id_centro_pesquisa = p.id_centro_pesquisa AND id_pericia = 2) AS nr_nivel_pericia2,							(SELECT nr_nivel FROM tb_pericia_centro WHERE id_centro_pesquisa = p.id_centro_pesquisa AND id_pericia = 3) AS nr_nivel_pericia3,							(SELECT nr_nivel FROM tb_pericia_centro WHERE id_centro_pesquisa = p.id_centro_pesquisa AND id_pericia = 4) AS nr_nivel_pericia4,							(SELECT nr_nivel FROM tb_pericia_centro WHERE id_centro_pesquisa = p.id_centro_pesquisa AND id_pericia = 5) AS nr_nivel_pericia5,							(SELECT nr_nivel FROM tb_pericia_centro WHERE id_centro_pesquisa = p.id_centro_pesquisa AND id_pericia = 6) AS nr_nivel_pericia6,							(SELECT nr_nivel FROM tb_pericia_centro WHERE id_centro_pesquisa = p.id_centro_pesquisa AND id_pericia = 7) AS nr_nivel_pericia7,							(SELECT nr_nivel FROM tb_pericia_centro WHERE id_centro_pesquisa = p.id_centro_pesquisa AND id_pericia = 8) AS nr_nivel_pericia8,							(SELECT nr_nivel FROM tb_pericia_centro WHERE id_centro_pesquisa = p.id_centro_pesquisa AND id_pericia = 9) AS nr_nivel_pericia9,							(SELECT nr_nivel FROM tb_pericia_centro WHERE id_centro_pesquisa = p.id_centro_pesquisa AND id_pericia = 10) AS nr_nivel_pericia10,							(SELECT nr_nivel FROM tb_pericia_centro WHERE id_centro_pesquisa = p.id_centro_pesquisa AND id_pericia = 11) AS nr_nivel_pericia11,							(SELECT nr_nivel FROM tb_pericia_centro WHERE id_centro_pesquisa = p.id_centro_pesquisa AND id_pericia = 12) AS nr_nivel_pericia12,							f.id_fabrica as id_fabrica,							f.nr_nivel as nr_nivel_fabrica,							f.nr_custo_nivel as nr_custo_fabrica,							f.nr_tecnologia_nivel as nr_tecnologia_fabrica,							m.id_mina as id_mina,							m.nr_nivel as nr_nivel_mina,							m.nr_captacao_nivel as nr_captacao_mina,							m.nr_personagem_nivel as nr_nivel_personagem_mina,							m.nr_custo_nivel as nr_custo_mina,							m.nr_ouro as nr_ouro_mina,							m.nr_cristal as nr_cristal_mina,							m.nr_plutonio as nr_plutonio_mina,							m.dt_acao as dt_acao_mina,							day(m.dt_acao) as dia_acao_mina, month(m.dt_acao) as mes_acao_mina, year(m.dt_acao) as ano_acao_mina, hour(m.dt_acao) as hora_acao_mina, minute(m.dt_acao) as minuto_acao_mina, second(m.dt_acao) as segundo_acao_mina,							(SELECT tx_nome FROM tb_pericia WHERE id_pericia = 1) AS tx_pericia1,							(SELECT tx_descricao FROM tb_pericia WHERE id_pericia = 1) AS tx_descper1,							(SELECT tx_nome FROM tb_pericia WHERE id_pericia = 2) AS tx_pericia2,							(SELECT tx_descricao FROM tb_pericia WHERE id_pericia = 2) AS tx_descper2,							(SELECT tx_nome FROM tb_pericia WHERE id_pericia = 3) AS tx_pericia3,							(SELECT tx_descricao FROM tb_pericia WHERE id_pericia = 3) AS tx_descper3,							(SELECT tx_nome FROM tb_pericia WHERE id_pericia = 4) AS tx_pericia4,							(SELECT tx_descricao FROM tb_pericia WHERE id_pericia = 4) AS tx_descper4,							(SELECT tx_nome FROM tb_pericia WHERE id_pericia = 5) AS tx_pericia5,							(SELECT tx_descricao FROM tb_pericia WHERE id_pericia = 5) AS tx_descper5,							(SELECT tx_nome FROM tb_pericia WHERE id_pericia = 6) AS tx_pericia6,							(SELECT tx_descricao FROM tb_pericia WHERE id_pericia = 6) AS tx_descper6,							(SELECT tx_nome FROM tb_pericia WHERE id_pericia = 7) AS tx_pericia7,							(SELECT tx_descricao FROM tb_pericia WHERE id_pericia = 7) AS tx_descper7,							(SELECT tx_nome FROM tb_pericia WHERE id_pericia = 8) AS tx_pericia8,							(SELECT tx_descricao FROM tb_pericia WHERE id_pericia = 8) AS tx_descper8,							(SELECT tx_nome FROM tb_pericia WHERE id_pericia = 9) AS tx_pericia9,							(SELECT tx_descricao FROM tb_pericia WHERE id_pericia = 9) AS tx_descper9,							(SELECT tx_nome FROM tb_pericia WHERE id_pericia = 10) AS tx_pericia10,							(SELECT tx_descricao FROM tb_pericia WHERE id_pericia = 10) AS tx_descper10,							(SELECT tx_nome FROM tb_pericia WHERE id_pericia = 11) AS tx_pericia11,							(SELECT tx_descricao FROM tb_pericia WHERE id_pericia = 11) AS tx_descper11,							(SELECT tx_nome FROM tb_pericia WHERE id_pericia = 12) AS tx_pericia12,							(SELECT tx_descricao FROM tb_pericia WHERE id_pericia = 12) AS tx_descper12,							(SELECT								sum(xp.nr_defesa * pc.nr_nivel)								FROM tb_pericia_centro pc								INNER JOIN tb_pericia xp								ON xp.id_pericia = pc.id_pericia								WHERE pc.id_centro_pesquisa = p.id_centro_pesquisa) AS nr_mais_alcance,              (SELECT								sum(xp.nr_poder* pc.nr_nivel)								FROM tb_pericia_centro pc								INNER JOIN tb_pericia xp								ON xp.id_pericia = pc.id_pericia								WHERE pc.id_centro_pesquisa = p.id_centro_pesquisa) AS nr_mais_poder,              (SELECT								sum(xp.nr_estabilidade* pc.nr_nivel)								FROM tb_pericia_centro pc								INNER JOIN tb_pericia xp								ON xp.id_pericia = pc.id_pericia								WHERE pc.id_centro_pesquisa = p.id_centro_pesquisa) AS nr_mais_velocidade_ataque,              (SELECT								sum(xp.nr_velocidade* pc.nr_nivel)								FROM tb_pericia_centro pc								INNER JOIN tb_pericia xp								ON xp.id_pericia = pc.id_pericia								WHERE pc.id_centro_pesquisa = p.id_centro_pesquisa) AS nr_mais_velocidade,              (SELECT								sum(xp.nr_energia* pc.nr_nivel)								FROM tb_pericia_centro pc								INNER JOIN tb_pericia xp								ON xp.id_pericia = pc.id_pericia								WHERE pc.id_centro_pesquisa = p.id_centro_pesquisa) AS nr_mais_energia,              (SELECT								sum(xp.nr_combustivel* pc.nr_nivel)								FROM tb_pericia_centro pc								INNER JOIN tb_pericia xp								ON xp.id_pericia = pc.id_pericia								WHERE pc.id_centro_pesquisa = p.id_centro_pesquisa) AS nr_mais_combustivel,              (SELECT								sum(xp.nr_critico* pc.nr_nivel)								FROM tb_pericia_centro pc								INNER JOIN tb_pericia xp								ON xp.id_pericia = pc.id_pericia								WHERE pc.id_centro_pesquisa = p.id_centro_pesquisa) AS nr_mais_critico							FROM tb_personagem a							INNER JOIN tb_centro_comando b 										ON a.id_personagem = b.id_personagem 							INNER JOIN tb_especialidade e							on e.id_especialidade = a.id_especialidade							INNER JOIN tb_centro_pesquisa p							on p.id_personagem = a.id_personagem							INNER JOIN tb_mina m							on m.id_personagem = a.id_personagem							INNER JOIN tb_fabrica f							on f.id_personagem = a.id_personagem							WHERE a.id_usuario = ".$Id;
$getdata=mysqli_query($con,$sql);
//Create an empty array
$json = array();//Fetch the data in a loop
while($r=mysqli_fetch_array($getdata)){
//Add the fetched vale to $json array
$json[] = $r;
}
//Encode the array to JSON
$json_data=json_encode($json); 

// Content type
header("Content-type: application/json");  

//JSONP - Make it as JSONP object
echo $_GET['callback'] . ' (' . $json_data . ');'; 

?>